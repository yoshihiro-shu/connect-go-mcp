# Simple Example

This example demonstrates how to use `connect-go-mcp` to generate MCP server tools from Protocol Buffer definitions.

## Overview

This example shows:
- How to define gRPC services in Protocol Buffers
- How to use `buf` with `connect-go-mcp` plugin
- How to create MCP servers with generated tools
- How to configure HTTP clients and authentication

## Project Structure

```
example/simple/
├── proto/user/v1/
│   └── user.proto          # Protocol Buffer definitions
├── gen/                    # Generated code (auto-generated)
├── buf.yaml               # Buf configuration
├── buf.gen.yaml           # Code generation configuration
├── go.mod                 # Go module definition
├── main.go                # Example MCP server implementation
├── Makefile               # Build automation
└── README.md              # This file
```

## Generated Files

After running `buf generate`, the following files are created:

- `gen/user/v1/user.pb.go` - Protocol Buffer message definitions
- `gen/user/v1/userv1connect/user.connect.go` - Connect-Go client/server code
- `gen/user/v1/user_mcpserver.go` - **MCP server tools (generated by connect-go-mcp)**

## Key Features Demonstrated

### 1. Protocol Buffer Definition

```protobuf
// ユーザー管理サービス
service UserService {
  // GetUser ユーザー情報取得
  rpc GetUser(GetUserRequest) returns (GetUserResponse) {}
  
  // CreateUser ユーザー作成
  rpc CreateUser(CreateUserRequest) returns (CreateUserResponse) {}
  
  // ListUsers ユーザー一覧取得
  rpc ListUsers(ListUsersRequest) returns (ListUsersResponse) {}
}
```

### 2. Generated MCP Tools

The `connect-go-mcp` plugin generates MCP tools for each RPC method:

- **GetUser ユーザー情報取得**: `user_id` (string parameter)
- **CreateUser ユーザー作成**: `name` (string), `email` (string parameters)
- **ListUsers ユーザー一覧取得**: `limit` (number), `offset` (number parameters)

### 3. Tool Parameter Mapping

- String fields → `mcp.WithString()` parameters
- Number fields → `mcp.WithNumber()` parameters
- Comments become tool descriptions
- RPC comments become tool names

## Usage

### Prerequisites

1. Install required tools:
   ```bash
   # Install protoc-gen-go
   go install google.golang.org/protobuf/cmd/protoc-gen-go@latest
   
   # Install protoc-gen-connect-go
   go install connectrpc.com/connect/cmd/protoc-gen-connect-go@latest
   
   # Install connect-go-mcp plugin (from project root)
   go install ./cmd/protoc-gen-connect-go-mcp
   ```

2. Make sure `buf` is installed:
   ```bash
   # Install buf
   brew install bufbuild/buf/buf
   # or download from https://github.com/bufbuild/buf
   ```

### Running the Example

1. Generate code:
   ```bash
   make generate
   # or manually: buf generate
   ```

2. Build and run:
   ```bash
   make run
   # or manually: go run .
   ```

3. Clean up:
   ```bash
   make clean
   ```

## Expected Output

When you run the example, you should see:

```
MCP server created successfully!
Available tools:
  - GetUser ユーザー情報取得: user_id (string)
  - CreateUser ユーザー作成: name (string), email (string)
  - ListUsers ユーザー一覧取得: limit (number), offset (number)

This is a demo - in a real application, you would:
1. Initialize stdio transport
2. Set up MCP transport handlers
3. Start the MCP server loop
Generated server: &{...}
```

## Code Generation Configuration

The `buf.gen.yaml` file configures three plugins:

1. **protoc-gen-go**: Generates basic Protocol Buffer Go code
2. **protoc-gen-connect-go**: Generates Connect-Go client/server code
3. **protoc-gen-connect-go-mcp**: Generates MCP server tools ✨

## Integration with MCP Clients

The generated MCP server can be integrated with MCP clients like:

- Claude Desktop
- VS Code extensions
- Custom MCP clients

Each RPC method becomes a callable tool with properly typed parameters and descriptions.

## Next Steps

1. **Implement actual API backend**: Replace the demo HTTP client with real API calls
2. **Add authentication**: Configure proper authentication tokens
3. **Error handling**: Add comprehensive error handling for API calls
4. **Logging**: Add structured logging for debugging
5. **Testing**: Add unit tests for the generated tools

## Related Files

- Parent project README: `../../README.ja.md`
- Core implementation: `../../tool_handler.go`
- Plugin implementation: `../../cmd/protoc-gen-connect-go-mcp/` 